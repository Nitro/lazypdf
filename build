#!/bin/bash -e
if [[ ! -d mupdf-1.12.0-source ]]; then
	echo "Downloading muPDF..."
	curl -L https://nitro-build-assets.s3.amazonaws.com/lazypdf/mupdf-1.12.0-source.tar.gz | tar -xzf -
fi

echo "Building muPDF..."
cd mupdf-1.12.0-source
make -j8 libs

# Newer OSX needs an include path for OpenSSL
if [[ `uname -s` == "Darwin" ]]; then
	export CGO_LDFLAGS="-L/usr/local/opt/openssl/lib"
fi

echo "Building Go application..."
cd -
go get ./...
go test -v
